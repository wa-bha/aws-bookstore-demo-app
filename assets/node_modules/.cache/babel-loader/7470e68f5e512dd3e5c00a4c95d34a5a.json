{"ast":null,"code":"import _regeneratorRuntime from\"/home/bw/Desktop/aws-bookstore-demo-app/assets/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/bw/Desktop/aws-bookstore-demo-app/assets/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"/home/bw/Desktop/aws-bookstore-demo-app/assets/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/home/bw/Desktop/aws-bookstore-demo-app/assets/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/home/bw/Desktop/aws-bookstore-demo-app/assets/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/bw/Desktop/aws-bookstore-demo-app/assets/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/bw/Desktop/aws-bookstore-demo-app/assets/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/bw/Desktop/aws-bookstore-demo-app/assets/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from\"react\";import{FormGroup,FormControl,ControlLabel,Form}from\"react-bootstrap\";import\"./checkoutForm.css\";import supportedCards from\"../../../images/supportedCards.png\";import{API}from\"aws-amplify\";import{Redirect}from\"react-router\";export var CheckoutForm=/*#__PURE__*/function(_React$Component){_inherits(CheckoutForm,_React$Component);var _super=_createSuper(CheckoutForm);function CheckoutForm(props){var _this;_classCallCheck(this,CheckoutForm);_this=_super.call(this,props);_this.getOrderTotal=function(){return _this.state.orders.reduce(function(total,book){return total+book.price*book.quantity;},0).toFixed(2);};_this.handleChange=function(event){var target=event.target;_this.setState(_objectSpread(_objectSpread({},_this.state),{},_defineProperty({},target.name,target.value)));};_this.onCheckout=function(){var orders=_this.state.orders;API.post(\"orders\",\"/orders\",{body:{books:orders}}).then(function(){return _this.setState({toConfirm:true});});};_this.state={card:'1010101010101010',expDate:undefined,ccv:'123',isLoading:true,toCart:false,orders:[],toConfirm:false};return _this;}_createClass(CheckoutForm,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var orders;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return this.listOrdersInCart();case 3:orders=_context.sent;this.setState({orders:orders});_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);alert(_context.t0);case 10:this.setState({isLoading:false});case 11:case\"end\":return _context.stop();}}},_callee,this,[[0,7]]);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"listOrdersInCart\",value:function listOrdersInCart(){return API.get(\"cart\",\"/cart\",null);}},{key:\"getCardNumberValidationState\",value:function getCardNumberValidationState(){var length=this.state.card.length;if(length>=15&&length<=19)return'success';else if(length!==0&&(length<15||length>19))return'error';return null;}},{key:\"render\",value:function render(){if(this.state.toConfirm)return/*#__PURE__*/React.createElement(Redirect,{to:\"/checkout-confirm\"});if(this.state.isLoading)return null;return/*#__PURE__*/React.createElement(\"div\",{className:\"well-bs col-md-12 full-page no-padding-top\"},/*#__PURE__*/React.createElement(\"div\",{className:\"white-box no-margin-top\"},/*#__PURE__*/React.createElement(\"div\",{className:\"checkout \"},/*#__PURE__*/React.createElement(\"img\",{src:supportedCards,alt:\"Supported cards\"}),/*#__PURE__*/React.createElement(Form,null,/*#__PURE__*/React.createElement(FormGroup,{controlId:\"card\",validationState:this.getCardNumberValidationState()},/*#__PURE__*/React.createElement(ControlLabel,null,\"Card number\"),/*#__PURE__*/React.createElement(FormControl,{name:\"card\",type:\"text\",value:this.state.card,onChange:this.handleChange}),/*#__PURE__*/React.createElement(FormControl.Feedback,null)),/*#__PURE__*/React.createElement(\"div\",{className:\"form-row\"},/*#__PURE__*/React.createElement(FormGroup,{controlId:\"expDate\"},/*#__PURE__*/React.createElement(ControlLabel,null,\"Expiration date\"),/*#__PURE__*/React.createElement(FormControl,{name:\"expDate\",type:\"date\",value:this.state.expDate,onChange:this.handleChange}),/*#__PURE__*/React.createElement(FormControl.Feedback,null)),/*#__PURE__*/React.createElement(FormGroup,{className:\"ccv\",controlId:\"ccv\"},/*#__PURE__*/React.createElement(ControlLabel,null,\"CCV\"),/*#__PURE__*/React.createElement(FormControl,{name:\"ccv\",type:\"text\",value:this.state.ccv,onChange:this.handleChange}),/*#__PURE__*/React.createElement(FormControl.Feedback,null)))))),/*#__PURE__*/React.createElement(\"div\",{className:\"pull-right\"},/*#__PURE__*/React.createElement(\"button\",{className:\"btn btn-black\",type:\"button\",onClick:this.onCheckout},\"Pay ($\".concat(this.getOrderTotal(),\")\"))));}}]);return CheckoutForm;}(React.Component);export default CheckoutForm;","map":{"version":3,"sources":["/home/bw/Desktop/aws-bookstore-demo-app/assets/src/modules/checkout/checkoutForm/CheckoutForm.tsx"],"names":["React","FormGroup","FormControl","ControlLabel","Form","supportedCards","API","Redirect","CheckoutForm","props","getOrderTotal","state","orders","reduce","total","book","price","quantity","toFixed","handleChange","event","target","setState","name","value","onCheckout","post","body","books","then","toConfirm","card","expDate","undefined","ccv","isLoading","toCart","listOrdersInCart","alert","get","length","getCardNumberValidationState","Component"],"mappings":"sxCAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,OAASC,SAAT,CAAoBC,WAApB,CAAiCC,YAAjC,CAA+CC,IAA/C,KAA6E,iBAA7E,CAEA,MAAO,oBAAP,CACA,MAAOC,CAAAA,cAAP,KAA2B,oCAA3B,CACA,OAASC,GAAT,KAAoB,aAApB,CACA,OAASC,QAAT,KAAyB,cAAzB,CAcA,UAAaC,CAAAA,YAAb,wHACE,sBAAYC,KAAZ,CAAsC,8CACpC,uBAAMA,KAAN,EADoC,MA+BtCC,aA/BsC,CA+BtB,UAAM,CACpB,MAAO,OAAKC,KAAL,CAAWC,MAAX,CAAkBC,MAAlB,CAAyB,SAACC,KAAD,CAAQC,IAAR,CAAiB,CAC/C,MAAOD,CAAAA,KAAK,CAAGC,IAAI,CAACC,KAAL,CAAaD,IAAI,CAACE,QAAjC,CACD,CAFM,CAEJ,CAFI,EAEDC,OAFC,CAEO,CAFP,CAAP,CAGD,CAnCqC,OA4CtCC,YA5CsC,CA4CvB,SAACC,KAAD,CAAyC,CACtD,GAAMC,CAAAA,MAAM,CAAGD,KAAK,CAACC,MAArB,CACA,MAAKC,QAAL,gCACK,MAAKX,KADV,wBAEGU,MAAM,CAACE,IAFV,CAEwBF,MAAM,CAACG,KAF/B,IAID,CAlDqC,OAoDtCC,UApDsC,CAoDzB,UAAM,CACjB,GAAMb,CAAAA,MAAM,CAAG,MAAKD,KAAL,CAAWC,MAA1B,CACAN,GAAG,CAACoB,IAAJ,CAAS,QAAT,CAAmB,SAAnB,CAA8B,CAC5BC,IAAI,CAAE,CACJC,KAAK,CAAEhB,MADH,CADsB,CAA9B,EAIGiB,IAJH,CAIQ,iBAAM,OAAKP,QAAL,CAAc,CAC1BQ,SAAS,CAAE,IADe,CAAd,CAAN,EAJR,EAOD,CA7DqC,CAGpC,MAAKnB,KAAL,CAAa,CACXoB,IAAI,CAAE,kBADK,CAEXC,OAAO,CAAEC,SAFE,CAGXC,GAAG,CAAE,KAHM,CAIXC,SAAS,CAAE,IAJA,CAKXC,MAAM,CAAE,KALG,CAMXxB,MAAM,CAAE,EANG,CAOXkB,SAAS,CAAE,KAPA,CAAb,CAHoC,aAYrC,CAbH,oJAeE,oLAEyB,MAAKO,gBAAL,EAFzB,QAEUzB,MAFV,eAGI,KAAKU,QAAL,CAAc,CACZV,MAAM,CAAEA,MADI,CAAd,EAHJ,+EAOI0B,KAAK,aAAL,CAPJ,QAUE,KAAKhB,QAAL,CAAc,CAAEa,SAAS,CAAE,KAAb,CAAd,EAVF,oEAfF,6IA4BE,2BAAmB,CACjB,MAAO7B,CAAAA,GAAG,CAACiC,GAAJ,CAAQ,MAAR,CAAgB,OAAhB,CAAyB,IAAzB,CAAP,CACD,CA9BH,4CAsCE,uCAA+B,CAC7B,GAAMC,CAAAA,MAAM,CAAG,KAAK7B,KAAL,CAAWoB,IAAX,CAAgBS,MAA/B,CACA,GAAIA,MAAM,EAAI,EAAV,EAAgBA,MAAM,EAAI,EAA9B,CAAkC,MAAO,SAAP,CAAlC,IACK,IAAIA,MAAM,GAAK,CAAX,GAAiBA,MAAM,CAAG,EAAT,EAAeA,MAAM,CAAG,EAAzC,CAAJ,CAAkD,MAAO,OAAP,CACvD,MAAO,KAAP,CACD,CA3CH,sBAgEE,iBAAS,CACP,GAAI,KAAK7B,KAAL,CAAWmB,SAAf,CAA0B,mBAAO,oBAAC,QAAD,EAAU,EAAE,CAAC,mBAAb,EAAP,CAE1B,GAAI,KAAKnB,KAAL,CAAWwB,SAAf,CAA0B,MAAO,KAAP,CAC1B,mBACE,2BAAK,SAAS,CAAC,4CAAf,eACE,2BAAK,SAAS,CAAC,yBAAf,eACE,2BAAK,SAAS,CAAC,WAAf,eACE,2BAAK,GAAG,CAAE9B,cAAV,CAA0B,GAAG,CAAC,iBAA9B,EADF,cAEE,oBAAC,IAAD,mBACE,oBAAC,SAAD,EACE,SAAS,CAAC,MADZ,CAEE,eAAe,CAAE,KAAKoC,4BAAL,EAFnB,eAGE,oBAAC,YAAD,oBAHF,cAIE,oBAAC,WAAD,EACE,IAAI,CAAC,MADP,CAEE,IAAI,CAAC,MAFP,CAGE,KAAK,CAAE,KAAK9B,KAAL,CAAWoB,IAHpB,CAIE,QAAQ,CAAE,KAAKZ,YAJjB,EAJF,cASE,oBAAC,WAAD,CAAa,QAAb,MATF,CADF,cAYE,2BAAK,SAAS,CAAC,UAAf,eACE,oBAAC,SAAD,EACE,SAAS,CAAC,SADZ,eAEE,oBAAC,YAAD,wBAFF,cAGE,oBAAC,WAAD,EACE,IAAI,CAAC,SADP,CAEE,IAAI,CAAC,MAFP,CAGE,KAAK,CAAE,KAAKR,KAAL,CAAWqB,OAHpB,CAIE,QAAQ,CAAE,KAAKb,YAJjB,EAHF,cAQE,oBAAC,WAAD,CAAa,QAAb,MARF,CADF,cAWE,oBAAC,SAAD,EACE,SAAS,CAAC,KADZ,CAEE,SAAS,CAAC,KAFZ,eAGE,oBAAC,YAAD,YAHF,cAIE,oBAAC,WAAD,EACE,IAAI,CAAC,KADP,CAEE,IAAI,CAAC,MAFP,CAGE,KAAK,CAAE,KAAKR,KAAL,CAAWuB,GAHpB,CAIE,QAAQ,CAAE,KAAKf,YAJjB,EAJF,cASE,oBAAC,WAAD,CAAa,QAAb,MATF,CAXF,CAZF,CAFF,CADF,CADF,cA0CE,2BAAK,SAAS,CAAC,YAAf,eACE,8BAAQ,SAAS,CAAC,eAAlB,CAAkC,IAAI,CAAC,QAAvC,CAAgD,OAAO,CAAE,KAAKM,UAA9D,kBAAoF,KAAKf,aAAL,EAApF,MADF,CA1CF,CADF,CAgDD,CApHH,0BAAkCV,KAAK,CAAC0C,SAAxC,EAuHA,cAAelC,CAAAA,YAAf","sourcesContent":["import React from \"react\";\nimport { FormGroup, FormControl, ControlLabel, Form, FormControlProps } from \"react-bootstrap\";\n\nimport \"./checkoutForm.css\";\nimport supportedCards from \"../../../images/supportedCards.png\";\nimport { API } from \"aws-amplify\";\nimport { Redirect } from \"react-router\";\n\ninterface CheckoutFormProps {}\n\ninterface CheckoutFormState {\n  card: string;\n  expDate: string | undefined;\n  ccv: string;\n  isLoading: boolean;\n  toCart: boolean;\n  orders: any[];\n  toConfirm: boolean;\n}\n\nexport class CheckoutForm extends React.Component<CheckoutFormProps, CheckoutFormState> {\n  constructor(props: CheckoutFormProps) {\n    super(props);\n\n    this.state = {\n      card: '1010101010101010',\n      expDate: undefined,\n      ccv: '123',\n      isLoading: true,\n      toCart: false,\n      orders: [],\n      toConfirm: false,\n    };\n  }\n\n  async componentDidMount() {\n    try {\n      const orders = await this.listOrdersInCart();\n      this.setState({\n        orders: orders\n      });\n    } catch (e) {\n      alert(e);\n    }\n\n    this.setState({ isLoading: false });\n  }\n\n  listOrdersInCart() {\n    return API.get(\"cart\", \"/cart\", null);\n  }\n\n  getOrderTotal = () => {\n    return this.state.orders.reduce((total, book) => {\n      return total + book.price * book.quantity\n    }, 0).toFixed(2);\n  }\n\n  getCardNumberValidationState() {\n    const length = this.state.card.length;\n    if (length >= 15 && length <= 19) return 'success';\n    else if (length !== 0 && (length < 15 || length > 19)) return 'error';\n    return null;\n  }\n\n  handleChange = (event: React.FormEvent<FormControl>) => {\n    const target = event.target as HTMLInputElement\n    this.setState({ \n      ...this.state,\n      [target.name as any]: target.value\n    });\n  }\n\n  onCheckout = () => {\n    const orders = this.state.orders;\n    API.post(\"orders\", \"/orders\", {\n      body: {\n        books: orders\n      }\n    }).then(() => this.setState({\n      toConfirm: true\n    }));\n  }\n\n  render() {\n    if (this.state.toConfirm) return <Redirect to='/checkout-confirm' />\n\n    if (this.state.isLoading) return null;\n    return (\n      <div className=\"well-bs col-md-12 full-page no-padding-top\">\n        <div className=\"white-box no-margin-top\">\n          <div className=\"checkout \">\n            <img src={supportedCards} alt=\"Supported cards\" />\n            <Form>\n              <FormGroup\n                controlId=\"card\"\n                validationState={this.getCardNumberValidationState()}>\n                <ControlLabel>Card number</ControlLabel>\n                <FormControl\n                  name=\"card\"\n                  type=\"text\"\n                  value={this.state.card}\n                  onChange={this.handleChange} />\n                <FormControl.Feedback />\n              </FormGroup>\n              <div className=\"form-row\">\n                <FormGroup\n                  controlId=\"expDate\">\n                  <ControlLabel>Expiration date</ControlLabel>\n                  <FormControl\n                    name=\"expDate\"\n                    type=\"date\"\n                    value={this.state.expDate}\n                    onChange={this.handleChange} />\n                  <FormControl.Feedback />\n                </FormGroup>\n                <FormGroup\n                  className=\"ccv\"\n                  controlId=\"ccv\">\n                  <ControlLabel>CCV</ControlLabel>\n                  <FormControl\n                    name=\"ccv\"\n                    type=\"text\"\n                    value={this.state.ccv}\n                    onChange={this.handleChange} />\n                  <FormControl.Feedback />\n                </FormGroup>\n              </div>\n            </Form>\n          </div>\n        </div>\n        <div className=\"pull-right\">\n          <button className=\"btn btn-black\" type=\"button\" onClick={this.onCheckout}>{`Pay ($${this.getOrderTotal()})`}</button>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default CheckoutForm;\n\n\n"]},"metadata":{},"sourceType":"module"}